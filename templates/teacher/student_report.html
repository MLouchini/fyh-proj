{% extends 'base.html' %}

{% block title %}Student Report - BuddyBud{% endblock %}

{% block nav %}
<a href="{% url 'teacher_view_results' homework.id %}">← Back to Results</a>
{% endblock %}

{% block content %}
<div class="container">
    <h1>{{ submission.student_name }}</h1>
    <p>{{ homework.title }} | Submitted: {{ submission.submitted_at|date:"M d, Y H:i" }}</p>
    
    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin: 40px 0;">
        <div class="card" style="text-align: center;">
            <h2>{{ submission.written_score }}%</h2>
            <p>Written Work</p>
        </div>
        <div class="card" style="text-align: center;">
            <h2>{{ submission.interview_score }}%</h2>
            <p>Interview</p>
        </div>
        <div class="card" style="text-align: center;">
            <h2>{{ submission.overall_score }}%</h2>
            <p>Overall Score</p>
        </div>
    </div>
    
    <div class="tabs">
        <button class="tab active" onclick="showTab('written')">Written Work</button>
        <button class="tab" onclick="showTab('interview')">Interview</button>
        <button class="tab" onclick="showTab('analysis')">Performance Analysis</button>
    </div>
    
    <div id="written" class="tab-content active">
        <h2>Written Work</h2>
        
        {% if submission.answer_file %}
        <div class="card">
            <h3>Submitted File</h3>
            <p><a href="{{ submission.answer_file.url }}" target="_blank" class="btn">View Submission</a></p>
        </div>
        {% endif %}
        
        {% if submission.answer_text %}
        <div class="card" style="margin-top: 20px;">
            <h3>Text Answer</h3>
            <div style="background: #000; padding: 20px; margin-top: 10px; white-space: pre-wrap; font-family: monospace;">{{ submission.answer_text }}</div>
        </div>
        {% endif %}
        
        <div class="card" style="margin-top: 20px;">
            <h3>Question Breakdown</h3>
            
            <div style="margin-top: 15px;">
                <h4>Q1: Strong (8/10)</h4>
                <p>Excellent formula application</p>
            </div>
            
            <div style="margin-top: 15px;">
                <h4>Q2: Strong (12/15)</h4>
                <p>Clear understanding of concepts</p>
            </div>
            
            <div style="margin-top: 15px;">
                <h4>Q3: Good (10/12)</h4>
                <p>Minor calculation errors</p>
            </div>
            
            <div style="margin-top: 15px;">
                <h4>Q4: Needs Work (9/13)</h4>
                <p>Conceptual gaps in EM fields</p>
            </div>
            
            <div style="margin-top: 15px;">
                <h4>Q5: Needs Work (6/10)</h4>
                <p>Lacks depth in quantum concepts</p>
            </div>
        </div>
    </div>
    
    <div id="interview" class="tab-content">
        <h2>Interview Recording</h2>
        
        {% if submission.interview.recording %}
        <div class="card">
            <video controls style="width: 100%; max-width: 800px; background: #000;">
                <source src="{{ submission.interview.recording.url }}" type="video/webm">
            </video>
        </div>
        
        <div class="card" style="margin-top: 20px;">
            <h3>Interview Performance</h3>
            <p><strong>Score:</strong> {{ submission.interview_score }}%</p>
            
            <h4 style="margin-top: 15px;">Strong Moments</h4>
            <p>• Thermodynamics explanation was excellent</p>
            <p>• Clear step-by-step thinking on Q1</p>
            <p>• Good use of analogies</p>
            
            <h4 style="margin-top: 15px;">Areas to Develop</h4>
            <p>• Magnetic field direction reasoning</p>
            <p>• Wave-particle duality explanation</p>
        </div>
        {% else %}
        <div class="card">
            <p>No interview recording available.</p>
        </div>
        {% endif %}
    </div>
    
    <div id="analysis" class="tab-content">
        <h2>Performance Analysis</h2>
        
        <div class="card">
            <h3>Strengths</h3>
            <p>• Strong understanding of core concepts</p>
            <p>• Clear explanations with good examples</p>
            <p>• Accurate calculations and proper units</p>
            <p>• Excellent problem-solving approach</p>
        </div>
        
        <div class="card" style="margin-top: 20px;">
            <h3>Areas for Improvement</h3>
            <p>• Electromagnetism concepts need review</p>
            <p>• Quantum mechanics depth lacking</p>
            <p>• Could provide more detailed explanations</p>
            <p>• Review right-hand rule applications</p>
        </div>
        
        <div class="card" style="margin-top: 20px;">
            <h3>Written vs Interview Comparison</h3>
            <p>Written: {{ submission.written_score }}% | Interview: {{ submission.interview_score }}%</p>
            
            {% if submission.interview_score > submission.written_score %}
            <p style="margin-top: 10px; color: #D4F14E;">Student scored higher on interview - good understanding, needs writing practice</p>
            {% elif submission.written_score > submission.interview_score %}
            <p style="margin-top: 10px; color: #F59E0B;">Student scored higher on written work - monitor for potential help received</p>
            {% else %}
            <p style="margin-top: 10px; color: #10B981;">Consistent performance across both - strong genuine understanding</p>
            {% endif %}
        </div>
        
        <div class="card" style="margin-top: 20px;">
            <h3>Recommendations</h3>
            <p>• Schedule 1-on-1 session for EM and Quantum topics</p>
            <p>• Assign additional practice problems</p>
            <p>• Encourage peer tutoring on strong topics</p>
        </div>
    </div>
</div>

<script>
function showTab(tabName) {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    
    event.target.classList.add('active');
    document.getElementById(tabName).classList.add('active');
}
</script>
{% endblock %}
