{% extends 'base.html' %}

{% block title %}View Results - BuddyBud{% endblock %}

{% block nav %}
<a href="{% url 'teacher_dashboard' %}">← Back to Dashboard</a>
{% endblock %}

{% block content %}
<div class="container">
    <h1>{{ homework.title }}</h1>
    <p>Code: <strong>{{ homework.code }}</strong> | Due: {{ homework.due_date|date:"M d, Y" }}</p>
    
    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin: 40px 0;">
        <div class="card" style="text-align: center;">
            <h2>{{ homework.submissions.count }}</h2>
            <p>Submissions</p>
        </div>
        <div class="card" style="text-align: center;">
            <h2>{{ avg_score|default:"--" }}%</h2>
            <p>Average Score</p>
        </div>
        <div class="card" style="text-align: center;">
            <h2>{{ completion_rate|default:"--" }}%</h2>
            <p>Completion Rate</p>
        </div>
        <div class="card" style="text-align: center;">
            <h2>{{ homework.submissions.count|default:0 }}</h2>
            <p>Reviewed</p>
        </div>
    </div>
    
    <div class="tabs">
        <button class="tab active" onclick="showTab('submissions')">Submissions</button>
        <button class="tab" onclick="showTab('analytics')">Class Analytics</button>
        <button class="tab" onclick="showTab('topics')">Topic Performance</button>
        <button class="tab" onclick="showTab('interviews')">Interview Insights</button>
    </div>
    
    <div id="submissions" class="tab-content active">
        <h2>Student Submissions</h2>
        
        {% if homework.submissions.all %}
            {% for submission in homework.submissions.all %}
            <div class="card" style="margin: 20px 0; cursor: pointer;" onclick="window.location.href='{% url 'teacher_student_report' submission.id %}'">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h3>{{ submission.student_name }}</h3>
                        <p>Submitted: {{ submission.submitted_at|date:"M d, Y H:i" }}</p>
                        <p>Status: {{ submission.status }}</p>
                    </div>
                    <div style="text-align: right;">
                        <h2>{{ submission.overall_score }}%</h2>
                        <p>Overall</p>
                    </div>
                </div>
                <div style="margin-top: 10px; display: flex; gap: 20px;">
                    <p>Written: {{ submission.written_score }}%</p>
                    <p>Interview: {{ submission.interview_score }}%</p>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="card">
                <p>No submissions yet. Share the code <strong>{{ homework.code }}</strong> with your students.</p>
            </div>
        {% endif %}
    </div>
    
    <div id="analytics" class="tab-content">
        <h2>Class Analytics</h2>
        
        <div class="card">
            <h3>Score Distribution</h3>
            <p>90-100%: <strong>{{ submissions_90_100|default:0 }}</strong> students</p>
            <p>80-89%: <strong>{{ submissions_80_89|default:0 }}</strong> students</p>
            <p>70-79%: <strong>{{ submissions_70_79|default:0 }}</strong> students</p>
            <p>60-69%: <strong>{{ submissions_60_69|default:0 }}</strong> students</p>
            <p>&lt;60%: <strong>{{ submissions_below_60|default:0 }}</strong> students</p>
        </div>
        
        <div class="card" style="margin-top: 20px;">
            <h3>Overall Performance</h3>
            <p>Average Score: <strong>{{ avg_score|default:"--" }}%</strong></p>
            <p>Highest Score: <strong>{{ highest_score|default:"--" }}%</strong></p>
            <p>Lowest Score: <strong>{{ lowest_score|default:"--" }}%</strong></p>
        </div>
    </div>
    
    <div id="topics" class="tab-content">
        <h2>Topic Performance</h2>
        <p>Based on question-level analysis across all submissions</p>
        
        <div class="card" style="margin-top: 20px;">
            <h3>Question 1: Newton's Laws</h3>
            <p>Average: <strong>82%</strong></p>
            <p>Students who struggled: 3</p>
        </div>
        
        <div class="card" style="margin-top: 20px;">
            <h3>Question 2: Thermodynamics</h3>
            <p>Average: <strong>78%</strong></p>
            <p>Students who struggled: 5</p>
        </div>
        
        <div class="card" style="margin-top: 20px;">
            <h3>Question 3: Wave Motion</h3>
            <p>Average: <strong>75%</strong></p>
            <p>Students who struggled: 6</p>
        </div>
        
        <div class="card" style="margin-top: 20px;">
            <h3>Question 4: Electromagnetism</h3>
            <p>Average: <strong>58%</strong></p>
            <p>Students who struggled: 15</p>
            <p style="color: #EF4444;">⚠ This topic needs class review</p>
        </div>
        
        <div class="card" style="margin-top: 20px;">
            <h3>Question 5: Quantum Mechanics</h3>
            <p>Average: <strong>64%</strong></p>
            <p>Students who struggled: 12</p>
        </div>
        
        <div class="card" style="margin-top: 20px; background: rgba(212, 241, 78, 0.1); border-color: #D4F14E;">
            <h3>Recommended Actions</h3>
            <p>• Review Electromagnetism in class (major gap)</p>
            <p>• Extra practice problems for Quantum Mechanics</p>
            <p>• 1-on-1 support for 3 students with consistent low scores</p>
        </div>
    </div>
    
    <div id="interviews" class="tab-content">
        <h2>Interview Insights</h2>
        <p>Comparing written vs verbal performance</p>
        
        <div class="card" style="margin-top: 20px;">
            <h3>Higher Verbal Performance</h3>
            <p><strong>{{ higher_verbal|default:12 }}</strong> students scored higher in interviews</p>
            <p>Pattern: Good understanding, but needs writing practice</p>
            <p>Recommendation: Practice writing out explanations before exams</p>
        </div>
        
        <div class="card" style="margin-top: 20px;">
            <h3>Higher Written Performance</h3>
            <p><strong>{{ higher_written|default:4 }}</strong> students scored higher on written work</p>
            <p>Pattern: May have received help on written work</p>
            <p>Recommendation: Monitor these students for academic honesty</p>
        </div>
        
        <div class="card" style="margin-top: 20px;">
            <h3>Consistent Performance</h3>
            <p><strong>{{ consistent|default:7 }}</strong> students scored similarly on both</p>
            <p>Pattern: Strong understanding across both formats</p>
            <p>Recommendation: These students can help peers</p>
        </div>
        
        <div class="card" style="margin-top: 20px;">
            <h3>Common Struggles in Interviews</h3>
            <p>• Magnetic field direction reasoning (15 students)</p>
            <p>• Wave-particle duality explanation (12 students)</p>
            <p>• Right-hand rule application (10 students)</p>
        </div>
    </div>
</div>

<script>
function showTab(tabName) {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    
    event.target.classList.add('active');
    document.getElementById(tabName).classList.add('active');
}
</script>
{% endblock %}
